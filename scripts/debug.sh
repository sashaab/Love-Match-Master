#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å nginx

set -e

echo "üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º —Å nginx..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
echo "üìä –°—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:"
docker-compose ps

echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ nginx
echo "üìã –õ–æ–≥–∏ nginx:"
docker-compose logs nginx

echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
echo "üìã –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:"
docker-compose logs app

echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
echo "üîß –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx:"
if [ -f nginx.conf ]; then
    echo "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è nginx.conf:"
    cat nginx.conf
else
    echo "‚ùå –§–∞–π–ª nginx.conf –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç—ã
echo "üîå –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Ä—Ç—ã:"
netstat -tlnp | grep :80 || echo "–ü–æ—Ä—Ç 80 –Ω–µ —Å–ª—É—à–∞–µ—Ç—Å—è"
netstat -tlnp | grep :443 || echo "–ü–æ—Ä—Ç 443 –Ω–µ —Å–ª—É—à–∞–µ—Ç—Å—è"

echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º volumes
echo "üíæ –ü—Ä–æ–≤–µ—Ä—è–µ–º volumes:"
docker volume ls | grep celebricy-game

echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç—å
echo "üåê –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–µ—Ç—å:"
docker network ls | grep celebricy-game

echo ""

echo "üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:"
echo "1. –ï—Å–ª–∏ nginx –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ: ./scripts/test-deploy.sh"
echo "2. –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å nginx.conf"
echo "3. –ï—Å–ª–∏ –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã, –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã"
echo "4. –î–ª—è –ø–æ–ª–Ω–æ–π –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏: docker-compose down && docker-compose up -d" 